import matplotlib.pyplot as plt
import numpy as np

from pycdt.build import triangulate, remove_holes


if __name__ == "__main__":
    arr = np.array(
        [
            [-15.5, -130.0],
            [-15.771, -128.461],
            [-16.553, -127.107],
            [-17.75, -126.103],
            [-19.219, -125.568],
            [-20.781, -125.568],
            [-22.25, -126.103],
            [-23.447, -127.107],
            [-24.229, -128.461],
            [-24.5, -130.0],
            [-22.0, -150.0],
            [-25.126, -149.727],
            [-28.156, -148.914],
            [-31.0, -147.588],
            [-33.57, -145.789],
            [-35.789, -143.57],
            [-37.588, -141.0],
            [-38.914, -138.156],
            [-39.727, -135.126],
            [-40.0, -132.0],
            [-70.0, -100.0],
            [-66.667, -100.0],
            [-63.333, -100.0],
            [-60.0, -100.0],
            [-56.667, -100.0],
            [-53.333, -100.0],
            [-50.0, -100.0],
            [-46.667, -100.0],
            [-43.333, -100.0],
            [-40.0, -100.0],
            [-18.0, -150.0],
            [-18.444, -150.0],
            [-18.889, -150.0],
            [-19.333, -150.0],
            [-19.778, -150.0],
            [-20.222, -150.0],
            [-20.667, -150.0],
            [-21.111, -150.0],
            [-21.556, -150.0],
            [0.0, 0.0],
            [-7.778, 0.0],
            [-15.556, 0.0],
            [-23.333, 0.0],
            [-31.111, 0.0],
            [-38.889, 0.0],
            [-46.667, 0.0],
            [-54.444, 0.0],
            [-62.222, 0.0],
            [-70.0, 0.0],
            [-70.0, -11.111],
            [-70.0, -22.222],
            [-70.0, -33.333],
            [-70.0, -44.444],
            [-70.0, -55.556],
            [-70.0, -66.667],
            [-70.0, -77.778],
            [-70.0, -88.889],
            [-40.0, -103.556],
            [-40.0, -107.111],
            [-40.0, -110.667],
            [-40.0, -114.222],
            [-40.0, -117.778],
            [-40.0, -121.333],
            [-40.0, -124.889],
            [-40.0, -128.444],
            [-24.229, -131.539],
            [-23.447, -132.893],
            [-22.25, -133.897],
            [-20.781, -134.432],
            [-19.219, -134.432],
            [-17.75, -133.897],
            [-16.553, -132.893],
            [-15.771, -131.539],
            [-14.874, -149.727],
            [-11.844, -148.914],
            [-9.0, -147.588],
            [-6.43, -145.789],
            [-4.211, -143.57],
            [-2.412, -141.0],
            [-1.086, -138.156],
            [-0.273, -135.126],
            [0.0, -132.0],
            [0.0, -14.667],
            [0.0, -29.333],
            [0.0, -44.0],
            [0.0, -58.667],
            [0.0, -73.333],
            [0.0, -88.0],
            [0.0, -102.667],
            [0.0, -117.333],
        ]
    )
    yy = triangulate(arr, margin=2.0)
    yy.plot(show=True, fontsize=2)
    constrained_edges = np.array(
        [
            [0, 1],
            [1, 2],
            [2, 3],
            [3, 4],
            [4, 5],
            [5, 6],
            [6, 7],
            [7, 8],
            [8, 9],
            [10, 11],
            [11, 12],
            [12, 13],
            [13, 14],
            [14, 15],
            [15, 16],
            [16, 17],
            [17, 18],
            [18, 19],
            [20, 21],
            [21, 22],
            [22, 23],
            [23, 24],
            [24, 25],
            [25, 26],
            [26, 27],
            [27, 28],
            [28, 29],
            [30, 31],
            [31, 32],
            [32, 33],
            [33, 34],
            [34, 35],
            [35, 36],
            [36, 37],
            [37, 38],
            [38, 10],
            [39, 40],
            [40, 41],
            [41, 42],
            [42, 43],
            [43, 44],
            [44, 45],
            [45, 46],
            [46, 47],
            [47, 48],
            [48, 49],
            [49, 50],
            [50, 51],
            [51, 52],
            [52, 53],
            [53, 54],
            [54, 55],
            [55, 56],
            [56, 20],
            [29, 57],
            [57, 58],
            [58, 59],
            [59, 60],
            [60, 61],
            [61, 62],
            [62, 63],
            [63, 64],
            [64, 19],
            [9, 65],
            [65, 66],
            [66, 67],
            [67, 68],
            [68, 69],
            [69, 70],
            [70, 71],
            [71, 72],
            [72, 0],
            [30, 73],
            [73, 74],
            [74, 75],
            [75, 76],
            [76, 77],
            [77, 78],
            [78, 79],
            [79, 80],
            [80, 81],
            [39, 82],
            [82, 83],
            [83, 84],
            [84, 85],
            [85, 86],
            [86, 87],
            [87, 88],
            [88, 89],
            [89, 81],
        ]
    )
    # plot them before calling the function
    fig, ax = plt.subplots()
    offset = 2
    for idx, v in enumerate(arr):
        ax.scatter(v[0], v[1], c="blue", s=2)
        ax.text(*(v + offset), str(idx), fontsize=5, color="red")  # type: ignore[reportCallIssue]

    for edge in constrained_edges:
        p1, p2 = arr[edge[0]], arr[edge[1]]
        ax.plot([p1[0], p2[0]], [p1[1], p2[1]], c="gray", lw=0.5)
    plt.show()

    remove_holes(yy, constrained_edges)  # type: ignore[reportArgumentType]
    yy.plot(show=True, fontsize=2)
